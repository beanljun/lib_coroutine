@startuml
start
:获取当前经过的毫秒数;
:创建一个用于存储过期定时器的向量;
:获取读锁;
if (定时器集合为空) then (是)
    :返回;
    stop
endif
:获取写锁;
if (定时器集合为空) then (是)
    :返回;
    stop
endif
:检测是否发生了时间回拨;
if (发生了时间回拨) then (是)
    :设置rollover为真;
else (否)
    if (定时器集合中的第一个定时器的执行时间大于当前时间) then (是)
        :返回;
        stop
    endif
endif
:创建一个新的定时器，其执行时间设置为当前时间;
:查找第一个不早于当前时间的定时器;
while (定时器的执行时间等于当前时间) is (是)
    :向后移动迭代器;
endwhile (否)
:将所有执行时间小于或等于当前时间的定时器添加到过期向量中;
:从定时器集合中移除所有执行时间小于或等于当前时间的定时器;
:预留足够的空间来存储所有过期的定时器的回调函数;
:初始化索引为0;
while (索引小于过期向量的长度) is (是)
    :获取过期向量中索引位置的定时器;
    :将定时器的回调函数添加到cbs向量中;
    if (定时器是循环的) then (是)
        :更新定时器的执行时间;
        :将定时器重新添加到定时器集合中;
    else (否)
        :将定时器的回调函数设置为null;
    endif
    :索引加1;
endwhile (否)
stop
@enduml